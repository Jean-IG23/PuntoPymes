# ğŸ“Š DIAGRAMAS VISUALES - ARQUITECTURA RBAC v2.0

---

## 1ï¸âƒ£ JERARQUÃA DE ROLES

```
                        ACCESO
                          â–²
                          â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                   â”‚             â”‚
                GLOBAL      LOCAL/PERSONAL
                   â”‚             â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
      â”‚                       â”‚  â”‚
   NIVEL 4              NIVEL 3 â”‚ â”‚
ADMIN_GLOBAL      GERENTE_SUCURSAL
   (RRHH)             (Oficina)    â”‚
   â”‚                    â”‚          â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚          â”‚
   â”‚ â”‚                â”‚ â”‚          â”‚
   â”‚ â”‚  Supervisa:    â”‚ â”‚      NIVEL 2
   â”‚ â”‚  â€¢ Gente       â”‚ â”‚  EMPLEADO_SUPERVISOR
   â”‚ â”‚  â€¢ Config      â”‚ â”‚      (Jefe)
   â”‚ â”‚  â€¢ NÃ³mina      â”‚ â”‚          â”‚
   â”‚ â”‚  â€¢ Org Chart   â”‚ â”‚          â”‚
   â”‚ â”‚                â”‚ â”‚      NIVEL 1
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      EMPLEADO
   â”‚                    â”‚      (Operario)
   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”
   â”‚    â”‚                 â”‚
   â”‚ Aprueba            Aprueba
   â”‚ Finalmente         Primero
   â”‚    â”‚                 â”‚
   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â””â”€â”€â†’ ACCESO A RECURSOS


JERARQUÃA DE PODER:
  ADMIN_GLOBAL (100%) > GERENTE_SUCURSAL (70%) > SUPERVISOR (40%) > EMPLEADO (10%)
```

---

## 2ï¸âƒ£ FLUJO DE SOLICITUD DE AUSENCIA

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚  JUAN (EMPLEADO, Sucursal Quito)                               â”‚
â”‚  â”œâ”€ Abre: "Solicitar Ausencia"                                 â”‚
â”‚  â”œâ”€ Tipo: Vacaciones                                           â”‚
â”‚  â”œâ”€ Fechas: 23-26 enero                                        â”‚
â”‚  â””â”€ Presiona: "CREAR"                                          â”‚
â”‚                    â†“                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  BACKEND (AutomÃ¡tico)                           â”‚
â”‚  1. Crear SolicitudAusencia                                     â”‚
â”‚     - estado = 'PENDIENTE_GERENTE'                             â”‚
â”‚     - empleado = juan                                           â”‚
â”‚                    â†“                                            â”‚
â”‚  2. Signal: solicitud_creada()                                 â”‚
â”‚     - Buscar gerente: Sucursal Quito                           â”‚
â”‚     - Encontrar: RICARDO (GERENTE_SUCURSAL)                    â”‚
â”‚                    â†“                                            â”‚
â”‚  3. Asignar:                                                    â”‚
â”‚     - aprobador_asignado = ricardo                             â”‚
â”‚     - estado = 'PENDIENTE_GERENTE'                             â”‚
â”‚                    â†“                                            â”‚
â”‚  4. Notificar:                                                  â”‚
â”‚     - usuario: ricardo@empresa.com                              â”‚
â”‚     - mensaje: "Juan solicita vacaciones 23-26 enero"          â”‚
â”‚                    â†“                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  RICARDO (GERENTE_SUCURSAL, Quito)                             â”‚
â”‚  â”œâ”€ Abre: "Solicitudes"                                        â”‚
â”‚  â”œâ”€ Ve: "Juan - Vacaciones 23-26 enero - PENDIENTE"           â”‚
â”‚  â”œâ”€ Lee detalles                                               â”‚
â”‚  â””â”€ Presiona: "APROBAR" + comentario                           â”‚
â”‚                    â†“                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              BACKEND: aprobar_solicitud_ausencia()              â”‚
â”‚  1. Validaciones:                                               â”‚
â”‚     âœ“ Â¿Ricardo es GERENTE_SUCURSAL? SÃ­                        â”‚
â”‚     âœ“ Â¿Juan es de Sucursal Quito? SÃ­                          â”‚
â”‚                    â†“                                            â”‚
â”‚  2. Estado cambia:                                              â”‚
â”‚     - PENDIENTE_GERENTE â†’ APROBADA_GERENTE                    â”‚
â”‚     - aprobado_por_gerente = ricardo                           â”‚
â”‚     - fecha_aprobacion_gerente = now()                         â”‚
â”‚                    â†“                                            â”‚
â”‚  3. Asignar a RRHH:                                             â”‚
â”‚     - Buscar: SOFÃA (ADMIN_GLOBAL)                             â”‚
â”‚     - aprobador_asignado = sofÃ­a                               â”‚
â”‚                    â†“                                            â”‚
â”‚  4. Notificar:                                                  â”‚
â”‚     - A SofÃ­a: "Ricardo aprobÃ³ solicitud de Juan"              â”‚
â”‚     - A Juan: "Tu gerente aprobÃ³ tu solicitud"                 â”‚
â”‚                    â†“                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  SOFÃA (ADMIN_GLOBAL, RRHH)                                    â”‚
â”‚  â”œâ”€ Abre: "Solicitudes por revisar"                            â”‚
â”‚  â”œâ”€ Ve: "Juan - APROBADA_GERENTE"                              â”‚
â”‚  â”œâ”€ Revisa comentarios de Ricardo                              â”‚
â”‚  â””â”€ Presiona: "APROBAR FINALMENTE"                             â”‚
â”‚                    â†“                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              BACKEND: aprobar_solicitud_ausencia()              â”‚
â”‚  1. Estado cambias:                                             â”‚
â”‚     - APROBADA_GERENTE â†’ APROBADA_FINAL                       â”‚
â”‚     - aprobado_por_rrhh = sofÃ­a                                â”‚
â”‚     - fecha_aprobacion_rrhh = now()                            â”‚
â”‚                    â†“                                            â”‚
â”‚  2. Acciones automÃ¡ticas:                                       â”‚
â”‚     - Ajustar saldo_vacaciones: juan.saldo -= 4                â”‚
â”‚     - Bloquear fechas en asistencia                            â”‚
â”‚     - Crear evento en calendario                               â”‚
â”‚                    â†“                                            â”‚
â”‚  3. Notificaciones:                                             â”‚
â”‚     - A Juan: âœ… "Tu solicitud fue aprobada finalmente"        â”‚
â”‚     - A Ricardo: "Solicitud de Juan confirmada"                â”‚
â”‚     - Auditar: ACCESO + APROBACIÃ“N                             â”‚
â”‚                    â†“                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  âœ… FLUJO COMPLETADO                                            â”‚
â”‚  Juan puede disfrutar sus vacaciones (23-26 enero)             â”‚
â”‚  Las fechas estÃ¡n bloqueadas en asistencia                     â”‚
â”‚  Todo fue documentado y auditado                               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3ï¸âƒ£ ROW-LEVEL SECURITY (RLS)

```
ESCENARIO: Consulta GET /api/empleados/

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USUARIO LOGUEADO            â”‚
â”‚  â€¢ ID: 5                      â”‚
â”‚  â€¢ Rol: GERENTE_SUCURSAL     â”‚
â”‚  â€¢ Sucursal: QUITO           â”‚
â”‚  â€¢ Empresa: TALENTTRACK      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ filter_queryset    â”‚
    â”‚_por_rol()          â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ IF rol == 'GERENTE_SUCURSAL' â”‚
    â”‚   â†’ WHERE sucursal = 'Quito' â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
    Database Query:
    SELECT * FROM personal_empleado
    WHERE empresa_id = 1
      AND sucursal_id = (quito_id)
         â”‚
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ RESULTADO:                   â”‚
    â”‚ [                            â”‚
    â”‚   {Juan, Quito, ...},       â”‚
    â”‚   {MarÃ­a, Quito, ...},      â”‚
    â”‚   {Carlos, Quito, ...},     â”‚
    â”‚   ... (50 empleados)         â”‚
    â”‚ ]                            â”‚
    â”‚                              â”‚
    â”‚ âŒ NO incluye:               â”‚
    â”‚   Empleados de Loja, Cuenca  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RESULTADO VISUAL PARA EL USUARIO:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Empleados (50)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Juan GarcÃ­a         - Quito          â”‚
â”‚ MarÃ­a LÃ³pez         - Quito          â”‚
â”‚ Carlos RodrÃ­guez    - Quito          â”‚
â”‚ ...                                  â”‚
â”‚                                      â”‚
â”‚ "Aparentemente solo hay 50 empleados"â”‚
â”‚                                      â”‚
â”‚ [Realidad: hay 200, pero RLS filtra] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4ï¸âƒ£ VALIDACIÃ“N EN CASCADA

```
INTENTO: Pedro (SUPERVISOR de Quito) crea tarea para LucÃ­a (Guayaquil)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND                                            â”‚
â”‚ - Selecciona: LucÃ­a                                 â”‚
â”‚ - Presiona: "Crear Tarea"                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“ POST /api/tareas/
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BACKEND: validar_puede_crear_tarea()                â”‚
â”‚                                                      â”‚
â”‚ ParÃ¡metros:                                          â”‚
â”‚ â€¢ creador = pedro (SUPERVISOR, Quito)              â”‚
â”‚ â€¢ asignado_a = lucÃ­a (EMPLEADO, Guayaquil)         â”‚
â”‚ â€¢ sucursal_destino = quito                          â”‚
â”‚                                                      â”‚
â”‚ LÃ³gica:                                              â”‚
â”‚ IF creador.rol == 'SUPERVISOR'                      â”‚
â”‚    AND asignado_a.departamento != creador.depto    â”‚
â”‚       â†’ return False, "LucÃ­a no estÃ¡ en tu depto"  â”‚
â”‚                                                      â”‚
â”‚ ValidaciÃ³n:                                          â”‚
â”‚ pedro.departamento = "Ventas, Quito"               â”‚
â”‚ lucÃ­a.departamento = "Finanzas, Guayaquil"         â”‚
â”‚                                                      â”‚
â”‚ "Ventas" != "Finanzas" â†’ BLOQUEAR âŒ                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“ RESPUESTA 400
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND: mostrar error                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ âš ï¸  ERROR                                      â”‚  â”‚
â”‚ â”‚ LucÃ­a es de Guayaquil.                        â”‚  â”‚
â”‚ â”‚ Solo puedes asignar tareas a tu equipo.       â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RESULTADO: La tarea NO se crea
           Pedro protegido de asignaciones invÃ¡lidas
           AuditorÃ­a registra intento fallido
```

---

## 5ï¸âƒ£ RESTRICCIONES DE UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        MENÃš DE NAVEGACIÃ“N            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  Rol: ADMIN_GLOBAL                  â”‚
â”‚  â”œâ”€ âœ… Dashboard                    â”‚
â”‚  â”œâ”€ âœ… Empleados                    â”‚
â”‚  â”œâ”€ âœ… Estructura Organizacional â˜…  â”‚
â”‚  â”œâ”€ âœ… Asistencia                   â”‚
â”‚  â”œâ”€ âœ… Tareas                       â”‚
â”‚  â”œâ”€ âœ… Solicitudes                  â”‚
â”‚  â”œâ”€ âœ… Objetivos                    â”‚
â”‚  â”œâ”€ âœ… NÃ³mina â˜…                     â”‚
â”‚  â”œâ”€ âœ… ConfiguraciÃ³n â˜…              â”‚
â”‚  â””â”€ âœ… Reportes                     â”‚
â”‚                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  Rol: GERENTE_SUCURSAL              â”‚
â”‚  â”œâ”€ âœ… Dashboard                    â”‚
â”‚  â”œâ”€ âœ… Empleados (su sucursal)      â”‚
â”‚  â”œâ”€ âŒ Estructura Organizacional    â”‚
â”‚  â”œâ”€ âœ… Asistencia (su sucursal)     â”‚
â”‚  â”œâ”€ âœ… Tareas                       â”‚
â”‚  â”œâ”€ âœ… Solicitudes (para aprobar)   â”‚
â”‚  â”œâ”€ âœ… Objetivos                    â”‚
â”‚  â”œâ”€ âŒ NÃ³mina                       â”‚
â”‚  â”œâ”€ âŒ ConfiguraciÃ³n                â”‚
â”‚  â””â”€ âœ… Reportes (locales)           â”‚
â”‚                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  Rol: EMPLEADO                      â”‚
â”‚  â”œâ”€ âŒ Dashboard                    â”‚
â”‚  â”œâ”€ âŒ Empleados                    â”‚
â”‚  â”œâ”€ âŒ Estructura Organizacional    â”‚
â”‚  â”œâ”€ âœ… Asistencia (propia)          â”‚
â”‚  â”œâ”€ âœ… Tareas (asignadas)           â”‚
â”‚  â”œâ”€ âœ… Solicitudes (propias)        â”‚
â”‚  â”œâ”€ âœ… Objetivos (propios)          â”‚
â”‚  â”œâ”€ âœ… NÃ³mina (propia)              â”‚
â”‚  â”œâ”€ âŒ ConfiguraciÃ³n                â”‚
â”‚  â””â”€ âŒ Reportes                     â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â˜… = MÃ³dulos especialmente sensibles
âœ… = Acceso permitido
âŒ = Acceso denegado (botÃ³n no aparece)
```

---

## 6ï¸âƒ£ ARQUITECTURA DE CAPAS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  PRESENTACIÃ“N (UI)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Angular Components                                  â”‚  â”‚
â”‚  â”‚ - main-layout: menÃº dinÃ¡mico por rol              â”‚  â”‚
â”‚  â”‚ - solicitudes: mostrar/ocultar botones            â”‚  â”‚
â”‚  â”‚ - empleados: tabla filtrada                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              GUARD & SEGURIDAD (Frontend)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ authGuard: Â¿EstÃ¡ logueado?                        â”‚  â”‚
â”‚  â”‚ roleBasedGuard: Â¿Tiene el rol?                    â”‚  â”‚
â”‚  â”‚ *ngIf: Â¿Mostrar elemento?                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  API REST (HTTP)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ GET /api/empleados/                               â”‚  â”‚
â”‚  â”‚ POST /api/ausencias/solicitudes/                  â”‚  â”‚
â”‚  â”‚ POST /api/ausencias/solicitudes/{id}/approve/     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          VALIDACIÃ“N NIVEL 1 (Action-Level)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ @require_permission('ausencias', 'aprobar')       â”‚  â”‚
â”‚  â”‚ tiene_permiso(user, modulo, accion)               â”‚  â”‚
â”‚  â”‚ âœ“ Â¿GERENTE puede aprobar? SÃ                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       VALIDACIÃ“N NIVEL 2 (Row-Level Security)           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ RLSQuerySetMixin                                   â”‚  â”‚
â”‚  â”‚ filter_queryset_por_rol()                         â”‚  â”‚
â”‚  â”‚ âœ“ Â¿Empleado es de su sucursal? SÃ                â”‚  â”‚
â”‚  â”‚ âœ“ WHERE sucursal = 'quito'                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚             LÃ“GICA DE NEGOCIO (Workflows)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ enrutar_solicitud_ausencia()                      â”‚  â”‚
â”‚  â”‚ aprobar_solicitud_ausencia()                      â”‚  â”‚
â”‚  â”‚ crear_notificacion()                              â”‚  â”‚
â”‚  â”‚ validar_puede_crear_tarea()                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚               BASE DE DATOS (PostgreSQL)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Empleado                                           â”‚  â”‚
â”‚  â”‚ SolicitudAusencia (con aprobador_asignado)       â”‚  â”‚
â”‚  â”‚ Tarea                                             â”‚  â”‚
â”‚  â”‚ AuditoriaAcceso                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7ï¸âƒ£ MATRIZ DE DECISIONES

```
                  Â¿PUEDE HACER ESTO?

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ACCIÃ“N      â”‚ ADMINâ”‚GERENTE â”‚SUPERVISOR â”‚EMPLEADO  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Ver empleado    â”‚  âœ…  â”‚ ğŸ”’ su  â”‚ ğŸ”’ equipo â”‚ âŒ       â”‚
â”‚ Crear empleado  â”‚  âœ…  â”‚  âŒ    â”‚  âŒ       â”‚ âŒ       â”‚
â”‚ Crear tarea     â”‚  âœ…  â”‚ âœ…*    â”‚ âœ…**      â”‚ âŒ       â”‚
â”‚ Crear ausencia  â”‚  âœ…  â”‚ âœ…***  â”‚ âœ…***     â”‚ âœ… propia â”‚
â”‚ Aprobar ausenciaâ”‚  âœ…  â”‚  âœ…    â”‚  âŒ       â”‚ âŒ       â”‚
â”‚ Ver nÃ³mina      â”‚  âœ…  â”‚  âŒ    â”‚  âŒ       â”‚ ğŸ”’ propiaâ”‚
â”‚ Ver Org Chart   â”‚  âœ…  â”‚  âŒ    â”‚  âŒ       â”‚ âŒ       â”‚
â”‚ Crear config    â”‚  âœ…  â”‚  âŒ    â”‚  âŒ       â”‚ âŒ       â”‚
â”‚ Ver reportes    â”‚  âœ…  â”‚ âœ…     â”‚ âœ…        â”‚ âŒ       â”‚
â”‚ Marcar asist.   â”‚  âœ…  â”‚ âœ…*    â”‚ âœ…*       â”‚ âœ… propiaâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… = Permitido
âŒ = Prohibido
ğŸ”’ = Limitado (RLS)
*  = Solo de su sucursal
** = Solo de su equipo
*** = Solicita, no aprueba
```

---

## 8ï¸âƒ£ FLUJO DE APROBACIÃ“N DE TAREAS

```
GERENTE crea tarea para EMPLEADO

   Gerente Ricardo                MarÃ­a (EMPLEADO)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Crear Tarea     â”‚             â”‚ Recibe APP   â”‚
   â”‚ â”œâ”€ TÃ­tulo       â”‚             â”‚ NotificaciÃ³n â”‚
   â”‚ â”œâ”€ DescripciÃ³n  â”‚             â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚ â”œâ”€ Para: MarÃ­a  â”‚                    â”‚
   â”‚ â””â”€ Crear        â”‚                    â†“
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                      â”‚ App abierta  â”‚
            â†“                      â”‚ "Nueva tarea"â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚ Backend valida  â”‚                    â”‚
   â”‚ â”œâ”€ Â¿Ricardo es  â”‚                    â†“
   â”‚ â”‚   GERENTE?    â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ â”‚   âœ“ SÃ        â”‚             â”‚ Abre tarea   â”‚
   â”‚ â””â”€ Â¿MarÃ­a es de â”‚             â”‚ â€¢ Lee detalleâ”‚
   â”‚    su sucursal? â”‚             â”‚ â€¢ Inicia     â”‚
   â”‚    âœ“ SÃ         â”‚             â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
            â”‚                            â†“
            â†“                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ Actualiza progreso   â”‚
   â”‚ Tarea creada âœ…  â”‚         â”‚ â€¢ Estado: EN PROCESO â”‚
   â”‚ â€¢ ID: 123        â”‚         â”‚ â€¢ % Completado: 50%  â”‚
   â”‚ â€¢ Estado: NUEVA  â”‚         â”‚ â€¢ Comentario: "..."  â”‚
   â”‚ â€¢ Para: MarÃ­a    â”‚         â”‚ â€¢ Guardar            â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                          â”‚
            â†“                          â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Notifica MarÃ­a: â”‚         â”‚ Tarea actualizadaâ”‚
   â”‚ "Ricardo te     â”‚         â”‚ Estado: EN CURSO â”‚
   â”‚ asignÃ³ tarea"   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
                                        â†“
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ Notifica Ricardo:    â”‚
                         â”‚ "MarÃ­a en progreso"  â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9ï¸âƒ£ TIMELINE DE IMPLEMENTACIÃ“N

```
SEMANA 1:
â”œâ”€ Lunes:   Actualizar modelos + Migraciones      (3h)
â”œâ”€ Martes:  Instalar rbac_avanzado + workflows    (2h)
â”œâ”€ MiÃ©rcoles: Agregar RLS a ViewSets               (3h)
â”œâ”€ Jueves:  Implementar Workflows                  (2h)
â””â”€ Viernes: Testing bÃ¡sico                         (2h)

SEMANA 2:
â”œâ”€ Lunes:   Restricciones de UI                   (2.5h)
â”œâ”€ Martes:  Testing completo                      (3h)
â”œâ”€ MiÃ©rcoles: AuditorÃ­a y logging                 (1.5h)
â”œâ”€ Jueves:  Staging testing                       (2h)
â””â”€ Viernes: ProducciÃ³n + Monitoring               (2h)

TOTAL: 20-24 horas
```

---

Documento Visual Completo  
Enero 23, 2026
