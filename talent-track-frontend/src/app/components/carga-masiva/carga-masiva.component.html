<div class="min-h-screen bg-gray-50 py-10 px-4 sm:px-6 lg:px-8">
  <div class="max-w-5xl mx-auto">
    
    <div class="md:flex md:items-center md:justify-between mb-8">
      <div>
        <h2 class="text-3xl font-extrabold text-gray-900 tracking-tight">Importación Masiva</h2>
        <p class="mt-2 text-sm text-gray-500">Carga múltiples empleados usando el formato estándar.</p>
      </div>
      <button routerLink="/empleados" class="mt-4 md:mt-0 text-indigo-600 hover:text-indigo-800 font-medium text-sm flex items-center gap-2 transition">
        <i class="bi bi-arrow-left"></i> Volver al Directorio
      </button>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      
      <div class="lg:col-span-1 space-y-6">
        
        <div class="bg-white shadow-lg rounded-2xl p-6 border border-gray-100">
          <h3 class="text-lg font-bold text-gray-900 mb-4">1. Cargar Archivo</h3>
          
          <div class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:bg-gray-50 transition relative group"
               [class.border-indigo-400]="archivoSeleccionado"
               [class.bg-indigo-50]="archivoSeleccionado">
            
            <input type="file" (change)="onFileSelected($event)" accept=".xlsx, .xls, .csv" 
                   class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" [disabled]="loading">
            
            <div class="space-y-3">
              <div class="w-12 h-12 bg-indigo-50 text-indigo-500 rounded-full flex items-center justify-center mx-auto transition duration-300"
                   [class.bg-green-100]="archivoSeleccionado" [class.text-green-600]="archivoSeleccionado">
                <i class="bi" [class]="archivoSeleccionado ? 'bi-file-earmark-excel-fill' : 'bi-cloud-upload'" style="font-size: 1.5rem;"></i>
              </div>
              
              <div *ngIf="!archivoSeleccionado">
                <p class="text-sm font-medium text-gray-700">Click para subir Excel</p>
                <p class="text-xs text-gray-400">Máximo 5MB</p>
              </div>

              <div *ngIf="archivoSeleccionado">
                <p class="text-sm font-bold text-green-700 truncate px-2">{{ archivoSeleccionado.name }}</p>
                <p class="text-xs text-green-600">{{ (archivoSeleccionado.size / 1024).toFixed(1) }} KB</p>
              </div>
            </div>
          </div>

          <p *ngIf="errorGeneral" class="text-red-500 text-xs mt-2 flex items-center gap-1 font-medium animate-pulse">
            <i class="bi bi-exclamation-circle"></i> {{ errorGeneral }}
          </p>

          <button (click)="subirArchivo()" 
                  [disabled]="!archivoSeleccionado || loading"
                  class="w-full mt-4 bg-indigo-600 text-white py-2.5 px-4 rounded-lg font-bold text-sm shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition flex justify-center items-center gap-2">
            <span *ngIf="loading" class="animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"></span>
            {{ loading ? 'Procesando...' : 'Procesar Archivo' }}
          </button>
        </div>

        <div class="bg-blue-50 rounded-xl p-5 border border-blue-100">
          <h4 class="text-sm font-bold text-blue-900 mb-2">¿Necesitas ayuda?</h4>
          <p class="text-xs text-blue-700 mb-3">Descarga el formato oficial para evitar errores de columnas.</p>
          <button (click)="descargarPlantilla()" class="w-full bg-white text-blue-600 border border-blue-200 py-2 rounded-lg text-xs font-bold hover:bg-blue-50 transition flex items-center justify-center gap-2">
            <i class="bi bi-download"></i> Descargar Plantilla
          </button>
        </div>

      </div>

      <div class="lg:col-span-2">
        
        <div *ngIf="!reporte" class="bg-white shadow-lg rounded-2xl overflow-hidden border border-gray-100 h-full">
          <div class="px-6 py-4 border-b border-gray-100 bg-gray-50 flex justify-between items-center">
            <h3 class="font-bold text-gray-800">Estructura del Excel</h3>
            <span class="text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded">Ejemplo</span>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full text-sm text-left whitespace-nowrap">
              <thead class="text-xs text-gray-500 uppercase bg-gray-50">
                <tr>
                  <th class="px-4 py-3">Cédula*</th>
                  <th class="px-4 py-3">Nombres*</th>
                  <th class="px-4 py-3">Sucursal</th>
                  <th class="px-4 py-3 text-indigo-600 font-bold">Área</th> <th class="px-4 py-3">Depto</th>
                  <th class="px-4 py-3">Cargo</th>
                  <th class="px-4 py-3">Supervisor?</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-100">
                <tr class="bg-white">
                  <td class="px-4 py-2 font-mono text-xs text-gray-600">1104567890</td>
                  <td class="px-4 py-2">Juan Perez</td>
                  <td class="px-4 py-2">Matriz</td>
                  <td class="px-4 py-2 text-indigo-600 font-medium">Tecnología</td>
                  <td class="px-4 py-2">Sistemas</td>
                  <td class="px-4 py-2">Dev Senior</td>
                  <td class="px-4 py-2 font-bold text-green-600">SI</td>
                </tr>
                <tr class="bg-gray-50/50">
                  <td class="px-4 py-2 font-mono text-xs text-gray-600">1712345678</td>
                  <td class="px-4 py-2">Maria Lopez</td>
                  <td class="px-4 py-2">Norte</td>
                  <td class="px-4 py-2 text-indigo-600 font-medium">Comercial</td>
                  <td class="px-4 py-2">Ventas</td>
                  <td class="px-4 py-2">Vendedor</td>
                  <td class="px-4 py-2 text-gray-400">NO</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="p-4 bg-yellow-50 text-xs text-yellow-800 border-t border-yellow-100">
            <i class="bi bi-info-circle-fill mr-1"></i>
            <strong>Importante:</strong> Si la Sucursal, Área, Departamento o Cargo no existen en el sistema, se crearán automáticamente al subir el archivo.
          </div>
        </div>

        <div *ngIf="reporte" class="bg-white shadow-lg rounded-2xl overflow-hidden border border-gray-100 animate-fade-in-up">
          
          <div class="px-6 py-5 border-b border-gray-100 flex justify-between items-center bg-gray-50">
            <div>
              <h3 class="font-bold text-gray-900 text-lg">Resultado del Proceso</h3>
              <p class="text-xs text-gray-500">Total filas procesadas: {{ reporte.total || 0 }}</p>
            </div>
            
            <div class="flex gap-3">
              <span class="flex items-center gap-1.5 px-3 py-1 rounded-full bg-green-100 text-green-700 text-sm font-bold border border-green-200">
                <i class="bi bi-check-circle-fill"></i> {{ reporte.creados }} Éxitos
              </span>
              <span *ngIf="reporte.errores?.length > 0" class="flex items-center gap-1.5 px-3 py-1 rounded-full bg-red-100 text-red-700 text-sm font-bold border border-red-200">
                <i class="bi bi-x-circle-fill"></i> {{ reporte.errores.length }} Errores
              </span>
            </div>
          </div>

          <div *ngIf="reporte.creados > 0 && (!reporte.errores || reporte.errores.length === 0)" class="p-10 text-center">
            <div class="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl">
              <i class="bi bi-emoji-smile-fill"></i>
            </div>
            <h4 class="text-xl font-bold text-gray-900">¡Carga Perfecta!</h4>
            <p class="text-gray-500 mt-2">Se importaron {{ reporte.creados }} empleados correctamente.</p>
            <button routerLink="/empleados" class="mt-6 px-6 py-2 bg-green-600 text-white rounded-lg font-bold shadow hover:bg-green-700 transition">
              Ver Empleados
            </button>
          </div>

          <div *ngIf="reporte.creados === 0 && (!reporte.errores || reporte.errores.length === 0)" class="p-10 text-center">
            <div class="w-16 h-16 bg-yellow-100 text-yellow-600 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl">
              <i class="bi bi-question-lg"></i>
            </div>
            <h4 class="text-xl font-bold text-gray-900">Sin datos procesados</h4>
            <p class="text-gray-500 mt-2">
              El archivo se leyó pero no se encontraron filas válidas.<br>
              Revisa que los encabezados del Excel coincidan con la plantilla.
            </p>
            <button (click)="reporte = null" class="mt-6 px-6 py-2 bg-gray-600 text-white rounded-lg font-bold shadow hover:bg-gray-700 transition">
              Intentar de nuevo
            </button>
          </div>

          <div *ngIf="reporte.errores?.length > 0" class="flex flex-col h-96">
            <div class="p-4 bg-red-50 border-b border-red-100 text-red-800 text-sm flex items-center gap-2">
              <i class="bi bi-exclamation-triangle-fill"></i>
              <span>Algunas filas no se pudieron procesar. Revisa el detalle abajo.</span>
            </div>
            
            <div class="flex-1 overflow-y-auto">
              <table class="min-w-full text-sm text-left">
                <thead class="text-xs text-gray-500 uppercase bg-gray-50 sticky top-0">
                  <tr>
                    <th class="px-6 py-3 w-20">Fila</th>
                    <th class="px-6 py-3">Detalle del Error</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                  <tr *ngFor="let err of erroresParseados" class="hover:bg-red-50 transition">
                    <td class="px-6 py-3 font-mono font-bold text-red-600">{{ err.fila }}</td>
                    <td class="px-6 py-3 text-gray-700">
                      {{ err.mensaje }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

        </div>

      </div>
    </div>
  </div>
</div>