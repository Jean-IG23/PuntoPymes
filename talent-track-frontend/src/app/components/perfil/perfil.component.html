<div class="min-h-screen bg-gray-50">
  <!-- HEADER ROJO -->
  <div class="bg-gradient-to-r from-red-600 to-red-700 text-white py-8 px-4 sm:px-6 lg:px-8" *ngIf="empleado">
    <div class="max-w-7xl mx-auto flex items-center justify-between">
      <div class="flex items-center gap-4">
        <!-- FOTO -->
        <div class="w-20 h-20 rounded-full border-4 border-white overflow-hidden bg-white flex items-center justify-center cursor-pointer group relative"
             #fileInputWrapper>
          <img *ngIf="imagePreview" [src]="imagePreview" class="w-full h-full object-cover">
          <span *ngIf="!imagePreview" class="text-2xl font-bold text-red-600">
            {{ empleado.nombres?.charAt(0).toUpperCase() }}
          </span>
          <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition flex items-center justify-center cursor-pointer"
               (click)="fileInputWrapper.click()">
            <i class="ri-camera-line text-white text-xl"></i>
          </div>
          <input type="file" #fileInputWrapper hidden (change)="onFileSelected($event)" class="hidden" accept="image/*">
        </div>

        <!-- INFO BÁSICA -->
        <div>
          <h1 class="text-3xl font-bold">{{ empleado.nombres }} {{ empleado.apellidos }}</h1>
          <p class="text-red-100">{{ empleado.puesto?.nombre || 'Sin Puesto' }}</p>
          <div class="flex gap-2 mt-2">
            <span class="px-3 py-1 bg-red-700 text-red-100 text-xs rounded-full font-semibold">{{ empleado.departamento?.nombre || 'N/A' }}</span>
            <span class="px-3 py-1 bg-green-500 text-white text-xs rounded-full font-semibold flex items-center gap-1">
              <i class="ri-check-line text-sm"></i> Activo
            </span>
          </div>
        </div>
      </div>

      <!-- BOTÓN EDITAR -->
      <button (click)="activeTab = 'informacion'" class="px-6 py-2 bg-white text-red-600 font-bold rounded-lg hover:bg-red-50 transition">
        <i class="ri-edit-line mr-2"></i> Editar
      </button>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8" *ngIf="empleado">
    
    <!-- TABS NAVEGACIÓN -->
    <div class="flex gap-6 border-b border-gray-200 mb-8">
      <button 
        (click)="setActiveTab('informacion')"
        [class.border-b-2]="activeTab === 'informacion'"
        [class.border-red-600]="activeTab === 'informacion'"
        [class.text-red-600]="activeTab === 'informacion'"
        [class.font-bold]="activeTab === 'informacion'"
        class="pb-4 text-gray-600 hover:text-red-600 transition">
        <i class="ri-information-line mr-2"></i> Información
      </button>
      <button 
        (click)="setActiveTab('desempeño')"
        [class.border-b-2]="activeTab === 'desempeño'"
        [class.border-red-600]="activeTab === 'desempeño'"
        [class.text-red-600]="activeTab === 'desempeño'"
        [class.font-bold]="activeTab === 'desempeño'"
        class="pb-4 text-gray-600 hover:text-red-600 transition">
        <i class="ri-bar-chart-line mr-2"></i> Desempeño
      </button>
      <button 
        (click)="setActiveTab('solicitudes')"
        [class.border-b-2]="activeTab === 'solicitudes'"
        [class.border-red-600]="activeTab === 'solicitudes'"
        [class.text-red-600]="activeTab === 'solicitudes'"
        [class.font-bold]="activeTab === 'solicitudes'"
        class="pb-4 text-gray-600 hover:text-red-600 transition">
        <i class="ri-mail-send-line mr-2"></i> Solicitudes
      </button>
    </div>

    <!-- TAB: INFORMACIÓN -->
    <div *ngIf="activeTab === 'informacion'" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      
      <!-- COLUMNA IZQUIERDA - INFO PERSONAL -->
      <div class="lg:col-span-1 space-y-6">
        
        <!-- DATOS PERSONALES -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
          <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
            <i class="ri-user-line text-red-600"></i> Información Personal
          </h3>
          <div class="space-y-4 text-sm">
            <div>
              <label class="text-gray-500 font-semibold">Email</label>
              <p class="text-gray-900 flex items-center gap-2">
                <i class="ri-mail-line text-red-600"></i>
                {{ empleado.usuario?.email }}
              </p>
            </div>
            <div>
              <label class="text-gray-500 font-semibold">Teléfono</label>
              <p class="text-gray-900 flex items-center gap-2">
                <i class="ri-phone-line text-red-600"></i>
                {{ empleado.telefono || 'No registrado' }}
              </p>
            </div>
            <div>
              <label class="text-gray-500 font-semibold">Documento</label>
              <p class="text-gray-900">{{ empleado.documento || 'N/A' }}</p>
            </div>
            <div>
              <label class="text-gray-500 font-semibold">ID Empleado</label>
              <p class="text-gray-900 font-mono text-xs bg-gray-50 px-2 py-1 rounded">#{{ empleado.id }}</p>
            </div>
          </div>
        </div>

        <!-- INFORMACIÓN EMPRESARIAL -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
          <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
            <i class="ri-building-line text-red-600"></i> Empresa
          </h3>
          <div class="space-y-4 text-sm">
            <div>
              <label class="text-gray-500 font-semibold">Empresa</label>
              <p class="text-gray-900">{{ empleado.empresa?.nombre || 'N/A' }}</p>
            </div>
            <div>
              <label class="text-gray-500 font-semibold">Sucursal</label>
              <p class="text-gray-900">{{ empleado.sucursal?.nombre || 'N/A' }}</p>
            </div>
            <div>
              <label class="text-gray-500 font-semibold">Departamento</label>
              <p class="text-gray-900">{{ empleado.departamento?.nombre || 'N/A' }}</p>
            </div>
            <div>
              <label class="text-gray-500 font-semibold">Puesto</label>
              <p class="text-gray-900">{{ empleado.puesto?.nombre || 'N/A' }}</p>
            </div>
            <div>
              <label class="text-gray-500 font-semibold">Turno</label>
              <p class="text-gray-900">{{ empleado.turno?.nombre || 'N/A' }}</p>
            </div>
            <div>
              <label class="text-gray-500 font-semibold">Fecha de Ingreso</label>
              <p class="text-gray-900">{{ formatDate(empleado.fecha_ingreso) }}</p>
            </div>
          </div>
        </div>

      </div>

      <!-- COLUMNA DERECHA - FORMULARIOS DE EDICIÓN -->
      <div class="lg:col-span-2 space-y-8">

        <!-- EDITAR CONTACTO -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
          <h3 class="text-lg font-bold text-gray-900 mb-6 flex items-center gap-2">
            <i class="ri-phone-line text-red-600"></i> Datos de Contacto
          </h3>

          <form [formGroup]="perfilForm" (ngSubmit)="guardarPerfil()">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Teléfono</label>
                <input 
                  type="text" 
                  formControlName="telefono" 
                  placeholder="123-456-7890"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600 focus:border-transparent">
              </div>
              <div class="md:col-span-2">
                <label class="block text-sm font-semibold text-gray-700 mb-2">Dirección</label>
                <input 
                  type="text" 
                  formControlName="direccion"
                  placeholder="123 Main Street, City, State 12345"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600 focus:border-transparent">
              </div>
            </div>

            <div class="flex justify-end">
              <button 
                type="submit" 
                [disabled]="loading || !perfilForm.dirty"
                class="px-6 py-2 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition flex items-center gap-2">
                <span *ngIf="loading" class="animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"></span>
                <i *ngIf="!loading" class="ri-save-line"></i>
                Guardar Cambios
              </button>
            </div>
          </form>
        </div>

        <!-- CAMBIAR CONTRASEÑA -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
          <h3 class="text-lg font-bold text-gray-900 mb-6 flex items-center gap-2">
            <i class="ri-shield-lock-line text-red-600"></i> Seguridad
          </h3>

          <form [formGroup]="passwordForm" (ngSubmit)="cambiarPassword()">
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Contraseña Actual</label>
                <input 
                  type="password" 
                  formControlName="old_password"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600 focus:border-transparent">
              </div>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2">Nueva Contraseña</label>
                  <input 
                    type="password" 
                    formControlName="new_password"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600 focus:border-transparent">
                </div>
                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2">Confirmar Nueva</label>
                  <input 
                    type="password" 
                    formControlName="confirm_password"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600 focus:border-transparent">
                </div>
              </div>

              <div *ngIf="passwordForm.errors?.['notSame'] && passwordForm.get('confirm_password')?.touched" 
                   class="text-red-600 text-sm font-semibold flex items-center gap-2">
                <i class="ri-alert-line"></i> Las contraseñas no coinciden.
              </div>
            </div>

            <div class="flex justify-end mt-6">
              <button 
                type="submit" 
                [disabled]="passwordForm.invalid || loading"
                class="px-6 py-2 bg-red-50 text-red-600 border border-red-200 font-bold rounded-lg hover:bg-red-100 disabled:opacity-50 transition">
                <i class="ri-refresh-line mr-2"></i> Actualizar Contraseña
              </button>
            </div>
          </form>
        </div>

      </div>

    </div>

    <!-- TAB: DESEMPEÑO -->
    <div *ngIf="activeTab === 'desempeño'" class="grid grid-cols-1 lg:grid-cols-3 gap-8">

      <!-- KPIs -->
      <div class="lg:col-span-2">
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
          <h3 class="text-lg font-bold text-gray-900 mb-6 flex items-center gap-2">
            <i class="ri-line-chart-line text-red-600"></i> KPIs Asignados
          </h3>
          
          <div *ngIf="kpis.length === 0" class="text-center py-12">
            <i class="ri-file-list-line text-4xl text-gray-300 mb-2"></i>
            <p class="text-gray-500">No hay KPIs asignados</p>
          </div>

          <div *ngIf="kpis.length > 0" class="space-y-4">
            <div *ngFor="let kpi of kpis" class="border border-gray-200 rounded-lg p-4 hover:shadow-sm transition">
              <div class="flex items-start justify-between">
                <div class="flex-1">
                  <h4 class="font-bold text-gray-900">{{ kpi.nombre }}</h4>
                  <p class="text-sm text-gray-600">{{ kpi.descripcion }}</p>
                </div>
                <span class="px-3 py-1 bg-red-50 text-red-600 text-xs font-bold rounded">{{ kpi.valor || '0' }}%</span>
              </div>
              <div class="mt-3 w-full bg-gray-200 rounded-full h-2">
                <div class="bg-red-600 h-2 rounded-full" [style.width.%]="kpi.valor || 0"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ESTADÍSTICAS -->
      <div class="space-y-4">
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
          <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
            <i class="ri-star-line text-red-600"></i> Evaluación General
          </h3>
          <div class="text-center">
            <div class="text-5xl font-bold text-red-600 mb-2">4.8/5</div>
            <div class="flex justify-center gap-1 mb-3">
              <i *ngFor="let _ of [1,2,3,4,5]" class="ri-star-fill text-yellow-400"></i>
            </div>
            <p class="text-sm text-gray-600">Desempeño excelente</p>
          </div>
        </div>

        <div class="bg-gradient-to-br from-red-50 to-red-100 rounded-lg shadow-sm border border-red-200 p-6">
          <h3 class="font-bold text-gray-900 mb-4">Metas Completadas</h3>
          <div class="text-4xl font-bold text-red-600 mb-1">{{ objetivos.length || 0 }}</div>
          <p class="text-sm text-gray-600">de {{ objetivos.length || 0 }} objetivos</p>
          <div class="mt-3 w-full bg-gray-300 rounded-full h-2">
            <div class="bg-red-600 h-2 rounded-full" style="width: 100%"></div>
          </div>
        </div>
      </div>

    </div>

    <!-- TAB: SOLICITUDES -->
    <div *ngIf="activeTab === 'solicitudes'">
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <h3 class="text-lg font-bold text-gray-900 mb-6 flex items-center gap-2">
          <i class="ri-mail-send-line text-red-600"></i> Solicitudes Recientes
        </h3>

        <div *ngIf="solicitudes.length === 0" class="text-center py-12">
          <i class="ri-inbox-line text-4xl text-gray-300 mb-2"></i>
          <p class="text-gray-500">No hay solicitudes</p>
        </div>

        <div *ngIf="solicitudes.length > 0" class="overflow-x-auto">
          <table class="w-full text-sm">
            <thead>
              <tr class="border-b border-gray-200">
                <th class="text-left py-3 px-4 font-bold text-gray-700">Fecha</th>
                <th class="text-left py-3 px-4 font-bold text-gray-700">Tipo</th>
                <th class="text-left py-3 px-4 font-bold text-gray-700">Descripción</th>
                <th class="text-left py-3 px-4 font-bold text-gray-700">Estado</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let solicitud of solicitudes" class="border-b border-gray-100 hover:bg-gray-50 transition">
                <td class="py-3 px-4 text-gray-900">{{ formatDate(solicitud.fecha_creacion) }}</td>
                <td class="py-3 px-4 text-gray-900 font-semibold">{{ solicitud.tipo || 'N/A' }}</td>
                <td class="py-3 px-4 text-gray-600">{{ solicitud.descripcion || 'Sin descripción' }}</td>
                <td class="py-3 px-4">
                  <span 
                    [ngClass]="{
                      'bg-green-50 text-green-700': getEstadoColor(solicitud.estado) === 'green',
                      'bg-orange-50 text-orange-700': getEstadoColor(solicitud.estado) === 'orange',
                      'bg-red-50 text-red-700': getEstadoColor(solicitud.estado) === 'red',
                      'bg-gray-50 text-gray-700': getEstadoColor(solicitud.estado) === 'gray'
                    }"
                    class="px-3 py-1 rounded-full text-xs font-bold">
                    {{ solicitud.estado || 'N/A' }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>

  <!-- LOADING -->
  <div *ngIf="loading" class="fixed inset-0 bg-black/30 flex items-center justify-center">
    <div class="bg-white rounded-lg p-8 flex flex-col items-center gap-4">
      <div class="animate-spin h-12 w-12 border-4 border-red-600 border-t-transparent rounded-full"></div>
      <p class="text-gray-700 font-semibold">Cargando perfil...</p>
    </div>
  </div>

</div>